name = "malnu-kananga-worker"
main = "worker.js"
compatibility_date = "2024-01-01"

# Deployment Status:
# - Production: https://malnu-kananga-worker-prod.cpa01cmz.workers.dev âœ… DEPLOYED
# - Development: Local only (wrangler dev --env dev)
#
# SETUP INSTRUCTIONS (for new deployments):
# 1. Create D1 database: wrangler d1 create malnu-kananga-db-prod
# 2. Copy the database_id from output and replace placeholder below
# 3. (Optional) Create R2 bucket: wrangler r2 bucket create malnu-kananga-files
# 4. Set JWT_SECRET environment variable (32+ characters): openssl rand -base64 32
# 5. Set GEMINI_API_KEY from Google AI Studio: https://ai.google.dev
# 6. Run: npm run validate-config to check configuration before deploying
# 7. After deployment, seed database: curl -X POST <WORKER_URL>/seed

# Default environment (for basic deployment without production/separate dev configs)
[[d1_databases]]
binding = "DB"
database_name = "malnu-kananga-db-dev"
database_id = "69605f72-4b69-4dd6-a72c-a17006f61254"

[vars]
ALLOWED_ORIGIN = "*"
NODE_ENV = "development"
LOG_LEVEL = "info"

# Environment bindings for production
[env.production]
name = "malnu-kananga-worker-prod"

# D1 Database bindings - created with: wrangler d1 create malnu-kananga-db-prod
[[env.production.d1_databases]]
binding = "DB"
database_name = "malnu-kananga-db-prod"
# Production D1 database ID
database_id = "7fbd7834-0fd2-475f-8787-55ce81988642"

# Vectorize index bindings - create with: wrangler vectorize create malnu-kananga-index --dimensions=768 --metric=cosine
# Note: Vectorize is optional. If not configured, AI chat features will be disabled gracefully.
# [[env.production.vectorize]]
# binding = "VECTORIZE_INDEX"
# index_name = "malnu-kananga-index"

# R2 Bucket bindings - create with: wrangler r2 bucket create malnu-kananga-files
# Note: R2 must be enabled in Cloudflare Dashboard first. If not configured, file operations will return 503.
# [[env.production.r2_buckets]]
# binding = "BUCKET"
# bucket_name = "malnu-kananga-files"

# Environment variables
[env.production.vars]
# Set to your production domain (for CORS)
ALLOWED_ORIGIN = "https://ma-malnukananga.sch.id"
# Secrets are set via: wrangler secret put <SECRET_NAME> --env production
# JWT_SECRET and GEMINI_API_KEY are managed as Cloudflare secrets, not in wrangler.toml
# See CLOUDFLARE_DEPLOYMENT.md for secret setup instructions
NODE_ENV = "production"
LOG_LEVEL = "error"

# Local development
[env.dev]
name = "malnu-kananga-worker-dev"

# D1 Database for development
# Created with: wrangler d1 create malnu-kananga-db-dev
[[env.dev.d1_databases]]
binding = "DB"
database_name = "malnu-kananga-db-dev"
# Dev D1 database ID
database_id = "69605f72-4b69-4dd6-a72c-a17006f61254"

# Vectorize index bindings - create with: wrangler vectorize create malnu-kananga-index-dev --dimensions=768 --metric=cosine
# Note: Vectorize is optional. If not configured, AI chat features will be disabled gracefully.
# [[env.dev.vectorize]]
# binding = "VECTORIZE_INDEX"
# index_name = "malnu-kananga-index-dev"

# R2 Bucket bindings - create with: wrangler r2 bucket create malnu-kananga-files-dev
# Note: R2 must be enabled in Cloudflare Dashboard first. If not configured, file operations will return 503.
# [[env.dev.r2_buckets]]
# binding = "BUCKET"
# bucket_name = "malnu-kananga-files-dev"

[env.dev.vars]
# Allow all origins for local development
ALLOWED_ORIGIN = "*"
# Secrets are set via: wrangler secret put <SECRET_NAME> --env dev
# JWT_SECRET_DEV and GEMINI_API_KEY are managed as Cloudflare secrets, not in wrangler.toml
# See CLOUDFLARE_DEPLOYMENT.md for secret setup instructions
NODE_ENV = "development"
# Log level
LOG_LEVEL = "info"
# Set your Gemini API key for AI features
# NOTE: Worker uses GEMINI_API_KEY (WITHOUT VITE_ prefix)
# Frontend uses VITE_GEMINI_API_KEY (WITH VITE_ prefix) - these are DIFFERENT services
# Set via Wrangler: echo "your_key" | wrangler secret put GEMINI_API_KEY --env dev
