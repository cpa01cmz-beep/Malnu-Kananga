import{j as n}from"../assets/index-lcGYEVDC.js";import{r as m}from"./chunk-BBfZGTUb.js";class d{static NOTIFICATIONS_KEY="malnu_notifications";static PREFERENCES_KEY="malnu_notification_preferences";static defaultPreferences={enableBrowserNotifications:!0,enableAcademicNotifications:!0,enableScheduleReminders:!0,enableGradeNotifications:!0,enableAnnouncementNotifications:!0,reminderTimeBeforeClass:15,quietHours:{enabled:!1,start:"22:00",end:"07:00"}};static getNotifications(){const e=localStorage.getItem(this.NOTIFICATIONS_KEY);return e?JSON.parse(e):[]}static saveNotifications(e){localStorage.setItem(this.NOTIFICATIONS_KEY,JSON.stringify(e))}static addNotification(e){const t=this.getNotifications(),i={...e,id:`notif_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),isRead:!1};return t.unshift(i),this.saveNotifications(t),this.shouldShowNotification(i)&&this.showInAppNotification(i),this.getPreferences().enableBrowserNotifications&&this.isBrowserNotificationSupported()&&this.requestBrowserNotificationPermission().then(s=>{s&&this.showBrowserNotification(i)}),i}static markAsRead(e){const t=this.getNotifications(),i=t.findIndex(s=>s.id===e);i!==-1&&(t[i].isRead=!0,this.saveNotifications(t))}static markAllAsRead(){const e=this.getNotifications();e.forEach(t=>t.isRead=!0),this.saveNotifications(e)}static deleteNotification(e){const i=this.getNotifications().filter(s=>s.id!==e);this.saveNotifications(i)}static clearAllNotifications(){this.saveNotifications([])}static getUnreadCount(){return this.getNotifications().filter(e=>!e.isRead).length}static getPreferences(){const e=localStorage.getItem(this.PREFERENCES_KEY);return e?{...this.defaultPreferences,...JSON.parse(e)}:this.defaultPreferences}static savePreferences(e){const i={...this.getPreferences(),...e};localStorage.setItem(this.PREFERENCES_KEY,JSON.stringify(i))}static shouldShowNotification(e){const t=this.getPreferences();switch(e.type){case"academic":if(!t.enableAcademicNotifications)return!1;break;case"schedule":if(!t.enableScheduleReminders)return!1;break;case"grade":if(!t.enableGradeNotifications)return!1;break;case"announcement":if(!t.enableAnnouncementNotifications)return!1;break}if(t.quietHours.enabled){const i=new Date,s=i.getHours()*100+i.getMinutes(),l=parseInt(t.quietHours.start.replace(":","")),r=parseInt(t.quietHours.end.replace(":",""));if(l>r){if(s>=l||s<=r)return!1}else if(s>=l&&s<=r)return!1}return!0}static showInAppNotification(e){const t=new CustomEvent("showNotification",{detail:e});window.dispatchEvent(t)}static isBrowserNotificationSupported(){return"Notification"in window}static async requestBrowserNotificationPermission(){return this.isBrowserNotificationSupported()?Notification.permission==="granted"?!0:Notification.permission==="denied"?!1:await Notification.requestPermission()==="granted":!1}static showBrowserNotification(e){if(!this.isBrowserNotificationSupported()||Notification.permission!=="granted")return;const t={body:e.message,icon:"/favicon.ico",badge:"/favicon.ico",tag:e.id,requireInteraction:e.priority==="urgent",silent:e.priority==="low"},i=new Notification(e.title,t);e.priority!=="urgent"&&setTimeout(()=>{i.close()},5e3),i.onclick=()=>{window.focus(),e.actionUrl&&(window.location.href=e.actionUrl),i.close()}}static scheduleClassReminder(e,t=15){const i=this.parseTimeString(e.time.split(" - ")[0]),s=new Date(i.getTime()-t*60*1e3),l=new Date,r=s.getTime()-l.getTime();r>0&&setTimeout(()=>{this.addNotification({title:"Pengingat Jadwal",message:`Kelas ${e.subject} akan dimulai dalam ${t} menit`,type:"schedule",priority:"medium",actionUrl:"/portal?tab=schedule"})},r)}static parseTimeString(e){const[t,i]=e.split(":").map(Number),s=new Date;return s.setHours(t,i,0,0),s}static initialize(){this.isBrowserNotificationSupported()&&Notification.permission==="default"&&this.requestBrowserNotificationPermission(),this.scheduleTodaysReminders(),setInterval(()=>{this.checkForScheduledNotifications()},6e4)}static scheduleTodaysReminders(){const e=this.getPreferences();if(!e.enableScheduleReminders)return;[{time:"07:00",subject:"Matematika"},{time:"08:45",subject:"Fisika"},{time:"10:30",subject:"Bahasa Indonesia"}].forEach(i=>{this.scheduleClassReminder(i,e.reminderTimeBeforeClass)})}static checkForScheduledNotifications(){const e=localStorage.getItem("malnu_last_notification_check"),t=Date.now();(!e||t-parseInt(e)>3e5)&&(localStorage.setItem("malnu_last_notification_check",t.toString()),Math.random()<.3&&this.addNotification({title:"Nilai Baru Tersedia",message:"Nilai ujian Matematika telah diupdate. Silakan cek portal akademik.",type:"grade",priority:"medium",actionUrl:"/portal?tab=grades"}))}}typeof window<"u"&&d.initialize();const E=({onNotificationClick:N})=>{const[e,t]=m.useState([]),[i,s]=m.useState(!1),[l,r]=m.useState(0);m.useEffect(()=>{t(d.getNotifications()),r(d.getUnreadCount());const a=o=>{const u=o.detail;t(c=>[u,...c]),r(c=>c+1)};return window.addEventListener("showNotification",a),()=>{window.removeEventListener("showNotification",a)}},[]);const h=a=>{a.isRead||(d.markAsRead(a.id),t(o=>o.map(u=>u.id===a.id?{...u,isRead:!0}:u)),r(o=>Math.max(0,o-1))),a.actionUrl&&(window.location.href=a.actionUrl),s(!1)},g=()=>{d.markAllAsRead(),t(a=>a.map(o=>({...o,isRead:!0}))),r(0)},b=()=>{d.clearAllNotifications(),t([]),r(0)},x=a=>{const o=new Date,u=new Date(a),c=Math.floor((o.getTime()-u.getTime())/(1e3*60));if(c<1)return"Baru saja";if(c<60)return`${c} menit lalu`;const f=Math.floor(c/60);return f<24?`${f} jam lalu`:`${Math.floor(f/24)} hari lalu`},p=a=>{switch(a){case"academic":return"ðŸ“š";case"schedule":return"ðŸ“…";case"grade":return"ðŸ“Š";case"announcement":return"ðŸ“¢";case"reminder":return"â°";case"system":return"âš™ï¸";default:return"ðŸ””"}},w=a=>{switch(a){case"urgent":return"border-l-red-500";case"high":return"border-l-orange-500";case"medium":return"border-l-blue-500";case"low":return"border-l-gray-500";default:return"border-l-gray-300"}};return n.jsxDEV("div",{className:"relative",children:[n.jsxDEV("button",{onClick:()=>s(!i),className:"relative p-2 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:[n.jsxDEV("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-5 5-5-5h5V12h-5l5-5 5 5h-5v5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:104,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:103,columnNumber:9},void 0),n.jsxDEV("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:l},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:106,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:99,columnNumber:7},void 0),i&&n.jsxDEV("div",{className:"absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50",children:[n.jsxDEV("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[n.jsxDEV("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Notifikasi"},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:115,columnNumber:13},void 0),n.jsxDEV("div",{className:"flex space-x-2",children:[l>0&&n.jsxDEV("button",{onClick:g,className:"text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"Tandai semua dibaca"},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:118,columnNumber:17},void 0),e.length>0&&n.jsxDEV("button",{onClick:b,className:"text-xs text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300",children:"Hapus semua"},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:126,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:116,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:114,columnNumber:11},void 0),n.jsxDEV("div",{className:"max-h-96 overflow-y-auto",children:e.length===0?n.jsxDEV("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:n.jsxDEV("p",{children:"Tidak ada notifikasi"},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:140,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:139,columnNumber:15},void 0):e.map(a=>n.jsxDEV("div",{onClick:()=>h(a),className:`p-4 border-b border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors border-l-4 ${w(a.priority)} ${a.isRead?"":"bg-blue-50 dark:bg-blue-900/20"}`,children:n.jsxDEV("div",{className:"flex items-start space-x-3",children:[n.jsxDEV("span",{className:"text-lg",children:p(a.type)},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:152,columnNumber:21},void 0),n.jsxDEV("div",{className:"flex-1 min-w-0",children:[n.jsxDEV("div",{className:"flex items-start justify-between",children:[n.jsxDEV("p",{className:`text-sm font-medium truncate ${a.isRead?"text-gray-700 dark:text-gray-300":"text-gray-900 dark:text-white"}`,children:a.title},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:155,columnNumber:25},void 0),!a.isRead&&n.jsxDEV("span",{className:"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 mt-1"},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:163,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:154,columnNumber:23},void 0),n.jsxDEV("p",{className:`text-sm mt-1 ${a.isRead?"text-gray-500 dark:text-gray-400":"text-gray-700 dark:text-gray-300"}`,children:a.message},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:166,columnNumber:23},void 0),n.jsxDEV("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-2",children:x(a.timestamp)},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:173,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:153,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:151,columnNumber:19},void 0)},a.id,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:144,columnNumber:17},void 0))},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:137,columnNumber:11},void 0),e.length>0&&n.jsxDEV("div",{className:"p-3 border-t border-gray-200 dark:border-gray-700",children:n.jsxDEV("button",{onClick:()=>s(!1),className:"w-full text-center text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"Lihat semua notifikasi"},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:186,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:185,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:112,columnNumber:9},void 0),i&&n.jsxDEV("div",{className:"fixed inset-0 z-40",onClick:()=>s(!1)},void 0,!1,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:199,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/user/Malnu-Kananga/src/components/NotificationBell.tsx",lineNumber:98,columnNumber:5},void 0)};export{d as N,E as a};
//# sourceMappingURL=chunk-D500K7SW.js.map
