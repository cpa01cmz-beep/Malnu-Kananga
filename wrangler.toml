name = "malnu-kananga-worker"
main = "worker.js"
compatibility_date = "2024-01-01"

# Production deployment - worker deployed to:
# https://malnu-kananga-worker.cpa01cmz.workers.dev
#
# SETUP INSTRUCTIONS:
# 1. Create D1 database: wrangler d1 create malnu-kananga-db
# 2. Copy the database_id from output and replace placeholder below
# 3. Create R2 bucket: wrangler r2 bucket create malnu-kananga-files
# 4. Set strong JWT_SECRET environment variable (32+ characters recommended)
# 5. Set actual VITE_GEMINI_API_KEY from Google Cloud Console
# 6. Run: npm run validate-config to check configuration before deploying

# Default environment (for basic deployment without production/separate dev configs)
[[d1_databases]]
binding = "DB"
database_name = "malnu-kananga-db-dev"
database_id = "69605f72-4b69-4dd6-a72c-a17006f61254"

[vars]
ALLOWED_ORIGIN = "*"
NODE_ENV = "development"
LOG_LEVEL = "info"

# Environment bindings for production
[env.production]
name = "malnu-kananga-worker-prod"

# D1 Database bindings - created with: wrangler d1 create malnu-kananga-db-prod
[[env.production.d1_databases]]
binding = "DB"
database_name = "malnu-kananga-db-prod"
# Production D1 database ID
database_id = "7fbd7834-0fd2-475f-8787-55ce81988642"

# Vectorize index bindings - create with: wrangler vectorize create malnu-kananga-index --dimensions=768 --metric=cosine
# Note: Vectorize is optional. If not configured, AI chat features will be disabled gracefully.
# [[env.production.vectorize]]
# binding = "VECTORIZE_INDEX"
# index_name = "malnu-kananga-index"

# R2 Bucket bindings - create with: wrangler r2 bucket create malnu-kananga-files
# Note: R2 must be enabled in Cloudflare Dashboard first. If not configured, file operations will return 503.
# [[env.production.r2_buckets]]
# binding = "BUCKET"
# bucket_name = "malnu-kananga-files"

# Environment variables
[env.production.vars]
# Set to your production domain (for CORS)
ALLOWED_ORIGIN = "https://ma-malnukananga.sch.id"
# Use JWT secret from environment variable
JWT_SECRET = "${JWT_SECRET}"
# Use Gemini API key from environment variable
# NOTE: Cloudflare Workers use GEMINI_API_KEY (WITHOUT VITE_ prefix)
# Frontend uses VITE_GEMINI_API_KEY (WITH VITE_ prefix) - these are DIFFERENT services
GEMINI_API_KEY = "${GEMINI_API_KEY}"
NODE_ENV = "production"
LOG_LEVEL = "error"

# Local development
[env.dev]
name = "malnu-kananga-worker-dev"

# D1 Database for development
# Created with: wrangler d1 create malnu-kananga-db-dev
[[env.dev.d1_databases]]
binding = "DB"
database_name = "malnu-kananga-db-dev"
# Dev D1 database ID
database_id = "69605f72-4b69-4dd6-a72c-a17006f61254"

# Vectorize index bindings - create with: wrangler vectorize create malnu-kananga-index-dev --dimensions=768 --metric=cosine
# Note: Vectorize is optional. If not configured, AI chat features will be disabled gracefully.
# [[env.dev.vectorize]]
# binding = "VECTORIZE_INDEX"
# index_name = "malnu-kananga-index-dev"

# R2 Bucket bindings - create with: wrangler r2 bucket create malnu-kananga-files-dev
# Note: R2 must be enabled in Cloudflare Dashboard first. If not configured, file operations will return 503.
# [[env.dev.r2_buckets]]
# binding = "BUCKET"
# bucket_name = "malnu-kananga-files-dev"

[env.dev.vars]
# Allow all origins for local development
ALLOWED_ORIGIN = "*"
# Use development JWT secret from environment variable
JWT_SECRET = "${JWT_SECRET_DEV}"
# Node environment
NODE_ENV = "development"
# Log level
LOG_LEVEL = "info"
# Set your Gemini API key for AI features
# NOTE: Worker uses GEMINI_API_KEY (WITHOUT VITE_ prefix)
# Frontend uses VITE_GEMINI_API_KEY (WITH VITE_ prefix) - these are DIFFERENT services
# Can be set in .env file instead: GEMINI_API_KEY=your_key
# GEMINI_API_KEY = "your_dev_gemini_api_key_here"
