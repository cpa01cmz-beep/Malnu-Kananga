name: "Reusable: iFlow CLI Action Setup"

on:
  workflow_call:
    inputs:
      timeout:
        description: "Timeout for the iFlow CLI action"
        required: false
        default: "7200"
        type: string
      debug:
        description: "Enable debug mode"
        required: false
        default: "false"
        type: string
      prompt:
        description: "Prompt for the iFlow CLI action"
        required: true
        type: string
      api_key:
        description: "API key for iFlow"
        required: true
        type: string
    secrets:
      GH_TOKEN:
        required: true
      IFLOW_API_KEY:
        required: true

# Add top-level permissions for least privilege
permissions:
  contents: read

jobs:
  iflow-cli:
    runs-on: ubuntu-slim
    name: iFlow CLI Action
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          fetch-depth: 0

      - name: "Run iFlow CLI"
        uses: iflow-ai/iflow-cli-action@v2.1.0
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
        with:
          api_key: ${{ inputs.api_key }}
          timeout: ${{ inputs.timeout }}
          debug: ${{ inputs.debug }}
          prompt: ${{ inputs.prompt }}
